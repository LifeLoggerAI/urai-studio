import { NextResponse , type NextRequest} from "next/server";
import { requireSession } from "@/lib/authServer";
import { enforcePlanIfEnabled, rateLimit } from "@/lib/gates";

export async function GET(req: NextRequest) {
  const { uid, email } = await requireSession();
  const limit = Number(process.env.URAI_REQS_PER_MIN || "120");
  await rateLimit(uid, { limit });
  await enforcePlanIfEnabled(uid, req);
  return NextResponse.json({ ok: true, uid, email });
}
